{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% block meta %} {% endblock meta %}    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <title>{% block title %}{{ app_title }}{% endblock %}</title>
    </head>
    <body>
        {% if not request.path == '/login/' and not request.path == '/register/' %}
            {% include 'navbar.html' %}
        {% else %}
            <header>
                <h1> {{ app_title }} </h1>
            </header>        
        {% endif %}
        {% if not request.path == '/login/' and not request.path == '/register/' %}
            <div class="container pt-20">
        {% else %}
            <div class="container">
        {% endif %}
            <main>
                {% block content %}{% endblock content %}
            </main>
        </div>
        <footer>
            Dibuat oleh <em>{{ name }}</em> dari kelas <em>{{ class }}</em>.
        </footer>
        {% include 'toast.html' %}
        {% if not request.path == '/login/' and not request.path == '/register/' and not request.path == '/create_product/' %}
            {% include 'modal.html' %}
        {% endif %}
        <form style="display:none">{% csrf_token %}</form>
        <script>
        function handleLogoutClick(e, url) {
            e.preventDefault();
            fetch(url, {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
                }
            }).then(response => {
                if (response.ok) {
                    showToast({
                        title: "Logged Out",
                        message: "You have been logged out successfully.",
                        type: "success"
                    });
                    setTimeout(() => {
                        window.location.href = "{% url 'main:login' %}";
                    }, 1200);
                } else {
                    showToast({
                        title: "Error",
                        message: "Logout failed.",
                        type: "error"
                    });
                }
            }).catch(() => {
                showToast({
                    title: "Error",
                    message: "Network error during logout.",
                    type: "error"
                });
            });
        }

        // Desktop logout
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
                handleLogoutClick(e, this.href);
            });
        }

        // Mobile logout
        const logoutBtnMobile = document.getElementById('logout-btn-mobile');
        if (logoutBtnMobile) {
            logoutBtnMobile.addEventListener('click', function(e) {
                handleLogoutClick(e, this.href);
            });
        }
        </script>
    </body>
</html>